document.addEventListener("DOMContentLoaded", () => {

    let data;

    data = {
        "_id": "68bc63ce74eaee3eb1317efc",
        "mobile": "8888888888",
        "idea": "I want to start a food delivery app in my city",
        "result": {
            "competitors": {
                "competitors": [
                    {
                        "company_name": "Uber Eats",
                        "established_year": "2014",
                        "estimated_market_share": "30–35%",
                        "founder": "Travis Kalanick, Garrett Camp",
                        "funding_stage": "public",
                        "his_techniques_for_success": "Leveraging an extensive logistics network, strategic partnerships with restaurants, and aggressive marketing strategies.",
                        "industry_or_niche": "Food Delivery",
                        "location": "San Francisco, CA, USA",
                        "market_position": "leader",
                        "monthly_traffic_or_users": "84 million",
                        "strengths": [
                            "Strong brand recognition",
                            "Extensive logistics and delivery network",
                            "Data-driven insights for restaurants and customers"
                        ],
                        "unique_selling_points": [
                            "Wide restaurant selection",
                            "Global brand presence",
                            "Integrated with Uber's ridesharing service"
                        ],
                        "weaknesses": [
                            "High delivery fees in some areas",
                            "High competition leading to profit challenges",
                            "Quality inconsistency in deliveries"
                        ],
                        "weaknesses_or_gaps": "Issues with delivery times and quality control present opportunities for niche players focusing on speed and customer satisfaction.",
                        "website": "www.ubereats.com",
                        "who_is_top_in_that_field": "Uber Eats"
                    },
                    {
                        "company_name": "DoorDash",
                        "established_year": "2013",
                        "estimated_market_share": "25%",
                        "founder": "Tony Xu, Stanley Tang, Andy Fang, Evan Moore",
                        "funding_stage": "public",
                        "his_techniques_for_success": "A focus on brand loyalty programs and partnerships to keep customers engaged, along with a strong marketing budget.",
                        "industry_or_niche": "Food Delivery",
                        "location": "San Francisco, CA, USA",
                        "market_position": "challenger",
                        "monthly_traffic_or_users": "32 million",
                        "strengths": [
                            "User-friendly app interface",
                            "Strong partnerships with local restaurants",
                            "Aggressive marketing and promotional offers"
                        ],
                        "unique_selling_points": [
                            "DashPass subscription for reduced fees",
                            "Strong focus on local businesses",
                            "Versatile delivery options including grocery and convenience items"
                        ],
                        "weaknesses": [
                            "Higher delivery times compared to competitors",
                            "Issues with driver retention",
                            "Rising operational costs affecting profitability"
                        ],
                        "weaknesses_or_gaps": "Inconsistent delivery experiences can deter users; there's an opportunity to implement a loyalty program targeted at frequent customers.",
                        "website": "www.doordash.com",
                        "who_is_top_in_that_field": "Uber Eats"
                    },
                    {
                        "company_name": "Grubhub",
                        "established_year": "2004",
                        "estimated_market_share": "15%",
                        "founder": "Matt Maloney, Mike Ely",
                        "funding_stage": "acquired (by Just Eat Takeaway)",
                        "his_techniques_for_success": "Fostering deep integration and loyalty with local restaurant networks; leveraging user feedback for improvements.",
                        "industry_or_niche": "Food Delivery",
                        "location": "Chicago, IL, USA",
                        "market_position": "challenger",
                        "monthly_traffic_or_users": "23 million",
                        "strengths": [
                            "Thorough restaurant filtering and rating systems",
                            "Good user engagement through rewards",
                            "Partnerships with many restaurants"
                        ],
                        "unique_selling_points": [
                            "Comprehensive restaurant reviews",
                            "Loyalty rewards program",
                            "Flexibility in food delivery and takeout"
                        ],
                        "weaknesses": [
                            "Higher fees for restaurants and consumers compared to rivals",
                            "Lack of several key regions",
                            "Delivery delays during peak times"
                        ],
                        "weaknesses_or_gaps": "Their high commission rates deter some local restaurants from joining, which opens potential to attract those restaurants with lower fees.",
                        "website": "www.grubhub.com",
                        "who_is_top_in_that_field": "Uber Eats"
                    }
                ],
                "insight": "To differentiate, the startup could focus on smaller, local, or underserved restaurants that may not currently have delivery options and provide lower fees for both consumers and businesses, along with superior service quality to address the common delivery complaints present in larger players."
            },
            "market": {
                "future_projection": [
                    {
                        "market_size": "USD 145B",
                        "year": 2026
                    }
                ],
                "historical_growth": [
                    {
                        "market_size": "USD 68B",
                        "year": 2020
                    },
                    {
                        "market_size": "USD 80B",
                        "year": 2021
                    },
                    {
                        "market_size": "USD 98B",
                        "year": 2022
                    },
                    {
                        "market_size": "USD 110B",
                        "year": 2023
                    },
                    {
                        "market_size": "USD 125B",
                        "year": 2024
                    }
                ],
                "key_trends": [
                    "Increasing reliance on mobile platforms for convenience and delivery services.",
                    "Growing consumer focus on sustainability and healthy food options.",
                    "Tightening regulations around food safety and labor practices impacting delivery services."
                ],
                "market_overview": {
                    "SAM": "USD 50B",
                    "SOM": "USD 5B",
                    "TAM": "USD 154B",
                    "methodology_note": "TAM calculated based on total food service market, SAM based on delivery segment, and SOM reflecting targeted market share within a specific city.",
                    "stage": "growing"
                },
                "summary": "The food delivery app market presents a significant growth opportunity as urban consumers increasingly prefer convenience. Emerging trends in technology and consumer preferences, coupled with market expansion potential in various regions, create a favorable environment for new entrants.",
                "top_regions": [
                    {
                        "region": "North America",
                        "why": "High consumer spending on convenience and technology adoption."
                    },
                    {
                        "region": "Asia Pacific",
                        "why": "Rapid urbanization and increase in demand for food delivery services."
                    },
                    {
                        "region": "Europe",
                        "why": "Strong market for restaurant partnerships and diverse culinary preferences."
                    },
                    {
                        "region": "Latin America",
                        "why": "Emerging smartphone penetration and demand for delivery apps."
                    },
                    {
                        "region": "Middle East",
                        "why": "Growing investment in tech ecosystems and food services."
                    }
                ]
            },
            "pricing": {
                "competitor_pricing": [
                    {
                        "cheapest_plan_usd": "0",
                        "model": "Hybrid (Freemium with subscription)",
                        "most_expensive_plan_usd": "unknown",
                        "name": "DoorDash",
                        "tiers": [
                            {
                                "features": [
                                    "No delivery fee on orders over $12",
                                    "Exclusive discounts"
                                ],
                                "plan": "DashPass",
                                "price_usd": "9.99/mo",
                                "target_customer": "Frequent users who order multiple times a week"
                            },
                            {
                                "features": [
                                    "Standard delivery"
                                ],
                                "plan": "Pay-per-use",
                                "price_usd": "Delivery fees vary",
                                "target_customer": "Occasional users who order infrequently"
                            }
                        ]
                    },
                    {
                        "cheapest_plan_usd": "1.99",
                        "model": "Hybrid (Freemium with subscription)",
                        "most_expensive_plan_usd": "unknown",
                        "name": "Grubhub",
                        "tiers": [
                            {
                                "features": [
                                    "Free delivery on orders over $12",
                                    "Exclusive perks"
                                ],
                                "plan": "Grubhub+ (subscription)",
                                "price_usd": "10.99/mo",
                                "target_customer": "Regular diners and enthusiasts"
                            },
                            {
                                "features": [
                                    "Standard delivery fee"
                                ],
                                "plan": "Pay-per-order",
                                "price_usd": "1.99-$9.99",
                                "target_customer": "Customers wanting one-time service"
                            }
                        ]
                    },
                    {
                        "cheapest_plan_usd": "1.49",
                        "model": "Hybrid (Freemium with subscription)",
                        "most_expensive_plan_usd": "unknown",
                        "name": "Uber Eats",
                        "tiers": [
                            {
                                "features": [
                                    "Reduced service fee",
                                    "No delivery fee on orders over $15"
                                ],
                                "plan": "Eats Pass",
                                "price_usd": "9.99/mo",
                                "target_customer": "Frequent orders by city dwellers"
                            },
                            {
                                "features": [
                                    "Variable delivery fees based on restaurant"
                                ],
                                "plan": "Pay-per-delivery",
                                "price_usd": "1.49-$7.99",
                                "target_customer": "Infrequent users or those trying new places"
                            }
                        ]
                    },
                    {
                        "cheapest_plan_usd": "2",
                        "model": "Hybrid (Freemium with subscription)",
                        "most_expensive_plan_usd": "unknown",
                        "name": "Postmates",
                        "tiers": [
                            {
                                "features": [
                                    "No delivery fee on orders over a set amount",
                                    "Exclusive offers"
                                ],
                                "plan": "Postmates Unlimited",
                                "price_usd": "9.99/mo",
                                "target_customer": "Urban dwellers ordering frequently"
                            },
                            {
                                "features": [
                                    "Standard delivery fees"
                                ],
                                "plan": "Pay-per-order",
                                "price_usd": "2-$5.99",
                                "target_customer": "Occasional users needing specific items"
                            }
                        ]
                    },
                    {
                        "cheapest_plan_usd": "1.99",
                        "model": "Freemium with subscription",
                        "most_expensive_plan_usd": "unknown",
                        "name": "Seamless",
                        "tiers": [
                            {
                                "features": [
                                    "No delivery fees on orders above $10"
                                ],
                                "plan": "Seamless+ (subscription)",
                                "price_usd": "9.99/mo",
                                "target_customer": "Regular customers dining out more"
                            },
                            {
                                "features": [
                                    "Variable delivery fees"
                                ],
                                "plan": "Standard delivery",
                                "price_usd": "1.99-$8.99",
                                "target_customer": "One-time diners or groups"
                            }
                        ]
                    }
                ],
                "insight": "Leveraging a subscription model with unique offerings tailored to niche markets can establish a strong competitive advantage and create customer loyalty over time.",
                "recommendation": "For your food delivery app, a hybrid pricing model that offers a low-cost subscription tier combined with pay-per-delivery options could attract both frequent and occasional users. Competitive subscription pricing, such as $9.99/month with benefits, alongside a transparent delivery fee structure will appeal to budget-conscious consumers while allowing flexibility. Additionally, consider integrating rewards or loyalty features to enhance retention."
            },
            "success": {
                "go_no_go_guidance": [
                    "Ensure at least 5 local restaurant partnerships are secured.",
                    "Achieve a 10% sign-up conversion rate on the landing page.",
                    "Obtain a customer satisfaction score of 4/5 or higher during the pilot."
                ],
                "mitigations": [
                    "Differentiate with unique features",
                    "Optimize marketing strategy for cost-effectiveness",
                    "Leverage local courier networks",
                    "Stay updated on regulations",
                    "Implement strict quality controls",
                    "Focus on niche markets to avoid saturation"
                ],
                "risks": [
                    "High competition",
                    "Customer acquisition costs",
                    "Logistical challenges",
                    "Regulatory compliance",
                    "Consistent quality assurance",
                    "Market saturation"
                ],
                "success_assessment": {
                    "justification": "The success probability for a food delivery app in your city is estimated at 65%. The market for food delivery is expanding, especially post-pandemic, indicating strong market readiness. User pain points such as convenience, time savings, and the desire for variety in dining are acute. However, the competitive landscape includes established players like DoorDash and Uber Eats, which increases pressure. Defensibility is limited as food delivery lacks robust network effects, though unique partnerships or localized offerings could help. Go-to-market feasibility is moderate, requiring strategic partnerships with local restaurants and effective marketing. Execution involves complexities like logistics and customer service, which are critical for success.",
                    "success_probability": 65
                },
                "validation_plan": [
                    {
                        "experiment": "Survey potential customers about delivery preferences",
                        "metric": "Response rate",
                        "target": "100+ responses",
                        "timeframe_weeks": 2
                    },
                    {
                        "experiment": "Develop a landing page with sign-up for early access",
                        "metric": "Conversion rate",
                        "target": "10% sign-up",
                        "timeframe_weeks": 3
                    },
                    {
                        "experiment": "Launch social media ads targeting local foodies",
                        "metric": "Engagement rate",
                        "target": "5% engagement",
                        "timeframe_weeks": 4
                    },
                    {
                        "experiment": "Partner with 5 local restaurants for a trial",
                        "metric": "Number of partnerships",
                        "target": "5 partnerships",
                        "timeframe_weeks": 5
                    },
                    {
                        "experiment": "Conduct a pilot delivery service for a weekend",
                        "metric": "Customer satisfaction score",
                        "target": "4/5 or above",
                        "timeframe_weeks": 6
                    },
                    {
                        "experiment": "Analyze competitor pricing models",
                        "metric": "Comparison report",
                        "target": "Complete analysis",
                        "timeframe_weeks": 3
                    }
                ]
            },
            "audience": {
                "channels": [
                    "Instagram",
                    "Google Ads",
                    "Local Food Blogs"
                ],
                "marketing_strategies": [
                    "Launch a referral program offering discounts for both the referrer and the new user to encourage sign-ups.",
                    "Create a partnership with local restaurants to offer exclusive deals or discounts for the first month.",
                    "Utilize social media influencers in the food niche to promote your app through reviews and giveaways.",
                    "Implement targeted promotions during peak meal times, focusing on delivering quick meals to attract busy professionals.",
                    "Organize a launch event combined with food tastings from partner restaurants to create buzz and engage the community."
                ],
                "primary_audience": "Young urban professionals aged 25-35 who value convenience and often order food due to busy work schedules and social lives.",
                "secondary_audience": "Students from local universities who seek affordable dining options and often use mobile apps for food delivery."
            },
            "tech": {
                "components": [
                    {
                        "build_vs_buy": "Buy - Utilize frameworks like React Native for multi-platform support.",
                        "key_tech_stack": [
                            "React",
                            "React Native",
                            "Redux",
                            "Tailwind CSS"
                        ],
                        "name": "Frontend Web & Mobile App",
                        "purpose": "User interface for customers and restaurant partners to browse, order, and manage deliveries.",
                        "risks": [
                            "UI/UX may not meet user expectations",
                            "Device compatibility issues"
                        ]
                    },
                    {
                        "build_vs_buy": "Build - Custom RESTful API using Node.js.",
                        "key_tech_stack": [
                            "Node.js",
                            "Express",
                            "GraphQL"
                        ],
                        "name": "Backend API",
                        "purpose": "Serve as the communication layer between frontend and database, handling requests and responses.",
                        "risks": [
                            "Performance bottlenecks",
                            "Security vulnerabilities"
                        ]
                    },
                    {
                        "build_vs_buy": "Buy - Use a managed database solution.",
                        "key_tech_stack": [
                            "PostgreSQL",
                            "Redis"
                        ],
                        "name": "Database",
                        "purpose": "Store user, delivery, and restaurant data in a structured manner.",
                        "risks": [
                            "Data loss",
                            "Inadequate scaling under load"
                        ]
                    },
                    {
                        "build_vs_buy": "Buy - Use cloud providers like AWS or GCP.",
                        "key_tech_stack": [
                            "AWS EC2",
                            "AWS RDS",
                            "AWS S3"
                        ],
                        "name": "Cloud Hosting",
                        "purpose": "Host applications, databases, and services in the cloud.",
                        "risks": [
                            "Vendor lock-in",
                            "Unexpected costs"
                        ]
                    },
                    {
                        "build_vs_buy": "Buy - Integrate with existing payment processors.",
                        "key_tech_stack": [
                            "Stripe",
                            "PayPal"
                        ],
                        "name": "Payment Gateway",
                        "purpose": "Process payments securely from users for their orders.",
                        "risks": [
                            "Compliance issues",
                            "Fraud"
                        ]
                    },
                    {
                        "build_vs_buy": "Build - Custom notification service or buy from suppliers.",
                        "key_tech_stack": [
                            "Firebase Cloud Messaging",
                            "AWS SNS"
                        ],
                        "name": "Notification Service",
                        "purpose": "Send real-time updates to users about their orders.",
                        "risks": [
                            "Delivery failures",
                            "High latency in notifications"
                        ]
                    }
                ],
                "cost_estimates": {
                    "dev_env_usd_month": "3000",
                    "prod_env_usd_month": "5000",
                    "staging_env_usd_month": "1500"
                },
                "data_model_notes": {
                    "retention_policy": "Retain user data for 2 years for insights, orders data for 5 years for analytics.",
                    "schema_highlights": [
                        "Users (id, name, email, address)",
                        "Orders (id, user_id, restaurant_id, status)",
                        "Restaurants (id, name, menu)"
                    ],
                    "sources": [
                        "User signups",
                        "Order history",
                        "Restaurant database"
                    ]
                },
                "infra_plan": {
                    "hosting": "AWS cloud with Elastic Beanstalk for deployment.",
                    "observability": [
                        "AWS CloudWatch for monitoring",
                        "Prometheus for metrics"
                    ],
                    "scaling": "Auto-scaling groups for instances based on load.",
                    "security": [
                        "SSL encryption for data in transit",
                        "AWS IAM for access control"
                    ]
                },
                "integration_matrix": [
                    {
                        "auth": "OAuth 2.0",
                        "notes": "Ensure PCI compliance.",
                        "rate_limit": "100 requests/min",
                        "service": "Stripe"
                    },
                    {
                        "auth": "API Key",
                        "notes": "Monitor for spam regulations.",
                        "rate_limit": "200 messages/min",
                        "service": "Twilio (for SMS)"
                    }
                ],
                "system_architecture": "A multi-tier architecture with separate presentation, business, and data layers, utilizing microservices for delivery management, user management, restaurant management, and order processing."
            },
            "time-budget": {
                "acceleration_options": [
                    {
                        "option": "Increase development team size",
                        "trade_off": "Higher costs but faster delivery."
                    },
                    {
                        "option": "Launch with limited features",
                        "trade_off": "Faster to market, but may impact user satisfaction."
                    },
                    {
                        "option": "Outsource specific phases",
                        "trade_off": "Cost savings, but less control over quality."
                    }
                ],
                "budget_estimate": {
                    "by_phase_usd": [
                        {
                            "high": 8000,
                            "low": 5000,
                            "phase": "Market Research & Validation"
                        },
                        {
                            "high": 12000,
                            "low": 8000,
                            "phase": "App Design & Prototyping"
                        },
                        {
                            "high": 30000,
                            "low": 20000,
                            "phase": "Development & Testing"
                        },
                        {
                            "high": 15000,
                            "low": 10000,
                            "phase": "Launch & Marketing"
                        },
                        {
                            "high": 5000,
                            "low": 3000,
                            "phase": "Post-Launch Support & Iteration"
                        }
                    ],
                    "total_usd": {
                        "high": 70000,
                        "low": 46000
                    }
                },
                "phases": [
                    {
                        "duration_weeks": 4,
                        "major_deliverables": [
                            "Market Research Report",
                            "User Interviews & Surveys",
                            "Value Proposition Document"
                        ],
                        "name": "Market Research & Validation",
                        "team_mix": [
                            {
                                "FTE": 0.5,
                                "role": "Market Analyst"
                            },
                            {
                                "FTE": 0.25,
                                "role": "Project Manager"
                            }
                        ]
                    },
                    {
                        "duration_weeks": 6,
                        "major_deliverables": [
                            "Wireframes",
                            "High-Fidelity Prototypes",
                            "User Testing Feedback"
                        ],
                        "name": "App Design & Prototyping",
                        "team_mix": [
                            {
                                "FTE": 1,
                                "role": "UI/UX Designer"
                            },
                            {
                                "FTE": 0.5,
                                "role": "Front-End Developer"
                            }
                        ]
                    },
                    {
                        "duration_weeks": 12,
                        "major_deliverables": [
                            "MVP Development",
                            "Testing Reports",
                            "Bug Fixes"
                        ],
                        "name": "Development & Testing",
                        "team_mix": [
                            {
                                "FTE": 1,
                                "role": "Back-End Developer"
                            },
                            {
                                "FTE": 1,
                                "role": "Front-End Developer"
                            },
                            {
                                "FTE": 0.5,
                                "role": "QA Engineer"
                            }
                        ]
                    },
                    {
                        "duration_weeks": 8,
                        "major_deliverables": [
                            "Launch Campaign",
                            "User Acquisition Metrics",
                            "Feedback Collection"
                        ],
                        "name": "Launch & Marketing",
                        "team_mix": [
                            {
                                "FTE": 1,
                                "role": "Marketing Specialist"
                            },
                            {
                                "FTE": 0.5,
                                "role": "Customer Support"
                            }
                        ]
                    },
                    {
                        "duration_weeks": 4,
                        "major_deliverables": [
                            "User Feedback Report",
                            "Product Iteration Plan"
                        ],
                        "name": "Post-Launch Support & Iteration",
                        "team_mix": [
                            {
                                "FTE": 0.5,
                                "role": "Product Manager"
                            },
                            {
                                "FTE": 0.5,
                                "role": "Developer"
                            }
                        ]
                    }
                ],
                "resource_plan": [
                    {
                        "FTE": 0.5,
                        "role": "Market Analyst",
                        "seniority": "Mid"
                    },
                    {
                        "FTE": 0.25,
                        "role": "Project Manager",
                        "seniority": "Senior"
                    },
                    {
                        "FTE": 1,
                        "role": "UI/UX Designer",
                        "seniority": "Mid"
                    },
                    {
                        "FTE": 1.5,
                        "role": "Front-End Developer",
                        "seniority": "Mid"
                    },
                    {
                        "FTE": 1,
                        "role": "Back-End Developer",
                        "seniority": "Senior"
                    },
                    {
                        "FTE": 0.5,
                        "role": "QA Engineer",
                        "seniority": "Mid"
                    },
                    {
                        "FTE": 1,
                        "role": "Marketing Specialist",
                        "seniority": "Mid"
                    },
                    {
                        "FTE": 0.5,
                        "role": "Customer Support",
                        "seniority": "Entry"
                    },
                    {
                        "FTE": 0.5,
                        "role": "Product Manager",
                        "seniority": "Senior"
                    }
                ],
                "schedule_risks": [
                    "Delays in market research could push back the design phase.",
                    "Limited user feedback might lead to an MVP that doesn’t meet market needs.",
                    "Technical challenges in app development may require additional time."
                ]
            },
            "team": {
                "core_team_profile": [
                    {
                        "coverage_gaps": [],
                        "role": "CEO",
                        "skills": [
                            "Leadership",
                            "Vision",
                            "Strategic planning"
                        ]
                    },
                    {
                        "coverage_gaps": [],
                        "role": "CTO",
                        "skills": [
                            "Technical expertise",
                            "Software development",
                            "Team management"
                        ]
                    },
                    {
                        "coverage_gaps": [],
                        "role": "CMO",
                        "skills": [
                            "Marketing strategy",
                            "User acquisition",
                            "Brand development"
                        ]
                    },
                    {
                        "coverage_gaps": [],
                        "role": "Lead Developer",
                        "skills": [
                            "Full-stack development",
                            "App architecture",
                            "Coding proficiency"
                        ]
                    },
                    {
                        "coverage_gaps": [],
                        "role": "Data Analyst",
                        "skills": [
                            "Data analysis",
                            "Statistical tools",
                            "Reporting"
                        ]
                    },
                    {
                        "coverage_gaps": [],
                        "role": "Operations Manager",
                        "skills": [
                            "Logistics",
                            "Process optimization",
                            "Team management"
                        ]
                    },
                    {
                        "coverage_gaps": [],
                        "role": "Customer Support Lead",
                        "skills": [
                            "Customer service",
                            "Problem solving",
                            "Communication"
                        ]
                    },
                    {
                        "coverage_gaps": [],
                        "role": "Sales Manager",
                        "skills": [
                            "Sales strategy",
                            "Relationship building",
                            "Negotiation"
                        ]
                    }
                ],
                "hiring_plan": [
                    {
                        "quarter": "Q1",
                        "reason": "Visionary leader to steer the startup.",
                        "role": "CEO",
                        "seniority": "Founder"
                    },
                    {
                        "quarter": "Q1",
                        "reason": "Technical leadership for app development.",
                        "role": "CTO",
                        "seniority": "Co-Founder"
                    },
                    {
                        "quarter": "Q1",
                        "reason": "Marketing strategies to acquire users.",
                        "role": "CMO",
                        "seniority": "Co-Founder"
                    },
                    {
                        "quarter": "Q2",
                        "reason": "Building and iterating the app.",
                        "role": "Lead Developer",
                        "seniority": "Mid-level"
                    },
                    {
                        "quarter": "Q2",
                        "reason": "Analyzing user data for insights.",
                        "role": "Data Analyst",
                        "seniority": "Junior"
                    },
                    {
                        "quarter": "Q3",
                        "reason": "Optimizing delivery logistics and operations.",
                        "role": "Operations Manager",
                        "seniority": "Mid-level"
                    },
                    {
                        "quarter": "Q3",
                        "reason": "Managing user inquiries and support.",
                        "role": "Customer Support Lead",
                        "seniority": "Mid-level"
                    },
                    {
                        "quarter": "Q4",
                        "reason": "Building partnerships with local restaurants.",
                        "role": "Sales Manager",
                        "seniority": "Junior"
                    }
                ],
                "interview_rubrics": [
                    {
                        "role": "CEO",
                        "top_signals": [
                            "Visionary thinking",
                            "Strong leadership",
                            "Industry knowledge",
                            "Risk assessment",
                            "Network connections"
                        ]
                    },
                    {
                        "role": "CTO",
                        "top_signals": [
                            "Technical proficiency",
                            "Problem-solving skills",
                            "Leadership experience",
                            "Vision for technology",
                            "Adaptability"
                        ]
                    },
                    {
                        "role": "CMO",
                        "top_signals": [
                            "Marketing experience",
                            "User acquisition skills",
                            "Creativity",
                            "Analytical thinking",
                            "Networking ability"
                        ]
                    },
                    {
                        "role": "Lead Developer",
                        "top_signals": [
                            "Strong coding skills",
                            "Project experience",
                            "Team collaboration",
                            "Problem-solving ability",
                            "Code quality standards"
                        ]
                    },
                    {
                        "role": "Data Analyst",
                        "top_signals": [
                            "Analytical skills",
                            "Data interpretation",
                            "Statistical knowledge",
                            "Communication skills",
                            "Software proficiency"
                        ]
                    }
                ],
                "org_design": {
                    "pods": [],
                    "reporting_lines": [
                        {
                            "CEO": [
                                "CTO",
                                "CMO"
                            ]
                        },
                        {
                            "CTO": [
                                "Lead Developer",
                                "Data Analyst"
                            ]
                        },
                        {
                            "CMO": [
                                "Sales Manager"
                            ]
                        },
                        {
                            "Operations Manager": [
                                "Customer Support Lead"
                            ]
                        }
                    ],
                    "structure": "Flat organization to promote collaboration."
                },
                "vendor_vs_inhouse": {
                    "what_to_keep_inhouse": [
                        "Development team",
                        "Customer support team"
                    ],
                    "what_to_outsource": [
                        "Delivery logistics management",
                        "Marketing campaigns"
                    ]
                }
            },
            "roadmap": {
                "roadmap": {
                    "critical_path": [
                        {
                            "sprint": 1,
                            "task": "Define core features and user personas."
                        },
                        {
                            "sprint": 2,
                            "task": "Finalizing the Minimum Viable Product (MVP) design."
                        },
                        {
                            "sprint": 6,
                            "task": "Complete user testing & iterate on feedback."
                        },
                        {
                            "sprint": 12,
                            "task": "Launch the food delivery app to the public."
                        }
                    ],
                    "dependencies": [
                        {
                            "from": "sprint 1",
                            "to": "sprint 2"
                        },
                        {
                            "from": "sprint 2",
                            "to": "sprint 3"
                        },
                        {
                            "from": "sprint 6",
                            "to": "sprint 7"
                        },
                        {
                            "from": "sprint 11",
                            "to": "sprint 12"
                        }
                    ],
                    "launch_checklist": [
                        {
                            "item": "Test critical functionalities like ordering and payment."
                        },
                        {
                            "item": "Ensure operational logistics are in place."
                        },
                        {
                            "item": "Prepare marketing materials for launch."
                        },
                        {
                            "item": "Define customer support processes."
                        }
                    ],
                    "post_launch_metrics": {
                        "guardrails": [
                            "Customer retention rate after 30 days.",
                            "Average order value (AOV).",
                            "Delivery time efficiency.",
                            "Monthly active users (MAU).",
                            "User satisfaction score."
                        ],
                        "north_star": "Daily active users (DAU)."
                    },
                    "roadmap": [
                        {
                            "key_tasks": [
                                "Conduct initial market research.",
                                "Identify key features for the MVP.",
                                "Create user personas.",
                                "Define target market."
                            ],
                            "owner_role": "Product Manager",
                            "sprint": 1,
                            "sprint_goal": "Establish product vision and user personas.",
                            "success_metric": "Completion of product vision documentation.",
                            "weeks": "1-2"
                        },
                        {
                            "key_tasks": [
                                "Create wireframes for the app.",
                                "Design user interface (UI) components.",
                                "Gather feedback on wireframes.",
                                "Define technical architecture."
                            ],
                            "owner_role": "UI/UX Designer",
                            "sprint": 2,
                            "sprint_goal": "Finalize MVP scope and design.",
                            "success_metric": "Approval of wireframes and UI design.",
                            "weeks": "3-4"
                        },
                        {
                            "key_tasks": [
                                "Set up development environments.",
                                "Develop user registration & login features.",
                                "Implement menu and ordering systems.",
                                "Initiate payment processing integration."
                            ],
                            "owner_role": "Lead Developer",
                            "sprint": 3,
                            "sprint_goal": "Begin development of core features.",
                            "success_metric": "Prototype demonstration of core features.",
                            "weeks": "5-6"
                        },
                        {
                            "key_tasks": [
                                "Complete development of the delivery tracking feature.",
                                "Implement customer feedback and rating system.",
                                "Develop order history feature.",
                                "Conduct code review sessions."
                            ],
                            "owner_role": "Lead Developer",
                            "sprint": 4,
                            "sprint_goal": "Build out remaining features of the MVP.",
                            "success_metric": "All MVP features implemented.",
                            "weeks": "7-8"
                        },
                        {
                            "key_tasks": [
                                "Run functional tests on all app features.",
                                "Fix identified bugs and issues.",
                                "Conduct performance testing.",
                                "Prepare for user testing phase."
                            ],
                            "owner_role": "QA Engineer",
                            "sprint": 5,
                            "sprint_goal": "Conduct internal testing and quality assurance.",
                            "success_metric": "Identification and resolution of critical bugs.",
                            "weeks": "9-10"
                        },
                        {
                            "key_tasks": [
                                "Select participants for user testing.",
                                "Gather feedback through surveys and interviews.",
                                "Analyze user feedback and determine necessary changes.",
                                "Revise the app based on user suggestions."
                            ],
                            "owner_role": "Product Manager",
                            "sprint": 6,
                            "sprint_goal": "Conduct user testing with target customers.",
                            "success_metric": "At least a 75% satisfaction rate in user feedback.",
                            "weeks": "11-12"
                        },
                        {
                            "key_tasks": [
                                "Adjust UI/UX based on feedback.",
                                "Fix any newly identified bugs.",
                                "Re-test the app to ensure all changes work.",
                                "Prepare for soft launch."
                            ],
                            "owner_role": "UI/UX Designer",
                            "sprint": 7,
                            "sprint_goal": "Implement changes from user testing feedback.",
                            "success_metric": "Completion of all revisions and re-testing.",
                            "weeks": "13-14"
                        },
                        {
                            "key_tasks": [
                                "Create promotional materials.",
                                "Develop a pre-launch marketing campaign.",
                                "Set up social media marketing strategies.",
                                "Establish partnerships with local restaurants."
                            ],
                            "owner_role": "Marketing Manager",
                            "sprint": 8,
                            "sprint_goal": "Develop marketing strategies and launch plans.",
                            "success_metric": "Creation of a complete marketing plan.",
                            "weeks": "15-16"
                        },
                        {
                            "key_tasks": [
                                "Implement delivery logistics and partnerships.",
                                "Set up customer support processes.",
                                "Train staff on using the app.",
                                "Establish payment reconciliation processes."
                            ],
                            "owner_role": "Operations Manager",
                            "sprint": 9,
                            "sprint_goal": "Finalize logistics for operations.",
                            "success_metric": "Operational readiness confirmed.",
                            "weeks": "17-18"
                        },
                        {
                            "key_tasks": [
                                "Launch app to a limited audience.",
                                "Gather feedback from users on the soft launch.",
                                "Monitor app performance closely.",
                                "Adjust marketing based on initial reception."
                            ],
                            "owner_role": "Product Manager",
                            "sprint": 10,
                            "sprint_goal": "Conduct a soft launch to gather initial feedback.",
                            "success_metric": "Feedback collected from at least 200 users.",
                            "weeks": "19-20"
                        },
                        {
                            "key_tasks": [
                                "Implement any final adjustments.",
                                "Prepare final marketing push for launch.",
                                "Create launch event strategies.",
                                "Ensure all user support tools are in place."
                            ],
                            "owner_role": "Marketing Manager",
                            "sprint": 11,
                            "sprint_goal": "Prepare for the full public launch.",
                            "success_metric": "All metrics ready for public launch.",
                            "weeks": "21-22"
                        },
                        {
                            "key_tasks": [
                                "Execute the full launch plan.",
                                "Monitor app and customer feedback actively.",
                                "Assess traffic and service metrics.",
                                "Begin ongoing marketing efforts."
                            ],
                            "owner_role": "Product Manager",
                            "sprint": 12,
                            "sprint_goal": "Launch the food delivery app to the public.",
                            "success_metric": "Achieve 1,000 downloads within the first week.",
                            "weeks": "23-24"
                        }
                    ]
                }
            }
        },
        "createdAt": "2025-09-06T16:39:42.295Z",
        "updatedAt": "2025-09-06T16:39:42.295Z",
        "__v": 0
    }


    const SECRET_KEY = "mySuperSecretKey123";

    function decryptData(ciphertext) {
        const bytes = CryptoJS.AES.decrypt(ciphertext, SECRET_KEY);
        return JSON.parse(bytes.toString(CryptoJS.enc.Utf8));
    }

    function getIdeaFromURL() {
        const urlParams = new URLSearchParams(window.location.search);
        const encryptedData = urlParams.get("data");
        if (encryptedData) {
            return decryptData(encryptedData);
        }
        else {
            initializeDashboard(data);
            setupPDFDownloader();
        }
        return null;
    }

    let idea = getIdeaFromURL();

    async function fetchResearchData(idea) {
        let user = localStorage.getItem("user");
        user = JSON.parse(user);
        mobile = user.mobile;
        idea = idea.idea;
        let request = await fetch(`http://localhost:3000/api/report/report1`, {
            method: "POST",
            headers: {
                "Content-Type": "application/json"
            },
            body: JSON.stringify({ mobile, idea })
        })
        data = await request.json();
        initializeDashboard(data);
        setupPDFDownloader();
    }

    fetchResearchData(idea);

    // --- RENDER FUNCTIONS ---
    function renderCompetitorsPage(data) {
        const insightContainer = document.getElementById("competitor-insight-card");
        const competitorGrid = document.getElementById("competitor-grid");
        if (!insightContainer || !competitorGrid) { console.error("Competitor containers not found!"); return; }
        insightContainer.innerHTML = ''; competitorGrid.innerHTML = '';
        if (data.insight) { insightContainer.innerHTML = `<h3>Key Strategic Insight</h3><p>${data.insight}</p>`; }
        if (data.competitors && data.competitors.length > 0) {
            data.competitors.forEach(comp => {
                const cardWrapper = document.createElement('div');
                cardWrapper.className = 'competitor-card-wrapper';
                cardWrapper.innerHTML = `
                    <div class="card competitor-card">
                        <div class="competitor-header">
                            <div><h2>${comp.company_name}</h2><p class="industry-niche">${comp.industry_or_niche}</p></div>
                            <span class="market-position ${comp.market_position}">${comp.market_position}</span>
                        </div>
                        <div class="competitor-body">
                            <div class="main-details">
                                <div class="data-section"><h3>Techniques for Success</h3><p class="techniques-text">${comp.his_techniques_for_success}</p></div>
                                <div class="sw-container">
                                    <div class="data-section strengths"><h3>Strengths</h3><ul>${comp.strengths.map(item => `<li>${item}</li>`).join('')}</ul></div>
                                    <div class="data-section weaknesses"><h3>Weaknesses</h3><ul>${comp.weaknesses.map(item => `<li>${item}</li>`).join('')}</ul></div>
                                </div>
                                <div class="data-section"><h3>Unique Selling Points</h3><ul>${comp.unique_selling_points.map(item => `<li>${item}</li>`).join('')}</ul></div>
                            </div>
                            <div class="key-metrics">
                                <h3>Key Metrics</h3>
                                <div class="key-metrics-grid">
                                    <div class="metric-item"><strong>Market Share</strong><span>${comp.estimated_market_share}</span></div>
                                    <div class="metric-item"><strong>Monthly Traffic</strong><span>${comp.monthly_traffic_or_users}</span></div>
                                    <div class="metric-item"><strong>Established</strong><span>${comp.established_year}</span></div>
                                    <div class="metric-item"><strong>Location</strong><span>${comp.location}</span></div>
                                    <div class="metric-item"><strong>Founder(s)</strong><span>${comp.founder}</span></div>
                                    <div class="metric-item"><strong>Funding</strong><span>${comp.funding_stage}</span></div>
                                </div>
                            </div>
                        </div>
                        <div class="competitor-footer"><p><strong>Identified Gap:</strong> ${comp.weaknesses_or_gaps}</p><a href="https://${comp.website}" target="_blank" class="website-link">Visit Website →</a></div>
                    </div>`;
                competitorGrid.appendChild(cardWrapper);
            });
        }
    }

    function renderRoadmapPage(data) {
        const container = document.getElementById('roadmap-content');
        if (!container || !data) return;

        // Unwrap roadmap object
        const roadmapObj = data.roadmap || {};
        const criticalPath = roadmapObj.critical_path || [];
        const launchChecklist = roadmapObj.launch_checklist || [];
        const postLaunchMetrics = roadmapObj.post_launch_metrics || {};
        const sprints = roadmapObj.roadmap || []; // ✅ The sprint array is inside roadmapObj

        container.innerHTML = `
    <div class="roadmap-container">
        <div class="roadmap-timeline-wrapper card">
            <h3>Critical Path</h3>
            <div class="roadmap-timeline">
                <div class="timeline-line"></div>
                ${criticalPath.map(item => `
                    <div class="timeline-node ${item.sprint ? 'is-critical' : ''}">
                        <div class="node-icon"></div>
                        <div class="node-content">
                            <strong>${item.sprint || 'N/A'}</strong>: ${item.task || 'N/A'}
                        </div>
                    </div>
                `).join('')}
            </div>
        </div>

        <div class="sprint-accordion card">
            <h3>Roadmap by Sprint</h3>
            ${sprints.map(sprint => `
                <div class="sprint-item">
                    <div class="sprint-header">
                        <h4>Sprint ${sprint.sprint || 'N/A'}: ${sprint.sprint_goal || 'N/A'}</h4>
                    </div>
                    <div class="sprint-content">
                        <p><strong>Owner:</strong> ${sprint.owner_role || 'N/A'}</p>
                        <p><strong>Weeks:</strong> ${sprint.weeks || 'N/A'}</p>
                        <p><strong>Success Metric:</strong> ${sprint.success_metric || 'N/A'}</p>
                        <strong>Key Tasks:</strong>
                        <ul>${(sprint.key_tasks || []).map(task => `<li>${task}</li>`).join('')}</ul>
                    </div>
                </div>
            `).join('')}
        </div>
    </div>

    <div class="card launch-checklist">
        <h3>Launch Checklist</h3>
        <ul>
            ${launchChecklist.map(item => `<li>${item.item || 'N/A'}</li>`).join('')}
        </ul>
    </div>

    <div class="card">
        <h3>Post-Launch Metrics</h3>
        <div class="data-section">
            <h4>Guardrails</h4>
            <ul>${(postLaunchMetrics.guardrails || []).map(m => `<li>${m}</li>`).join('')}</ul>
            <h4>North Star</h4>
            <p>${postLaunchMetrics.north_star || 'N/A'}</p>
        </div>
    </div>
    `;

        // Accordion toggle
        container.querySelectorAll('.sprint-header').forEach(header => {
            header.addEventListener('click', () => {
                const content = header.nextElementSibling;
                content.classList.toggle('is-open');
            });
        });
    }

    function renderMarketTrendsPage(data) {
        const container = document.getElementById('market-trends-content');
        if (!container || !data) return;
        const overview = data.market_overview;
        const historical = data.historical_growth;
        const future = data.future_projection[0];
        container.innerHTML = `
            <section id="market-summary-card" class="card"><h3>Market Summary</h3><p>${data.summary}</p></section>
            <div class="market-overview-grid">
                <div class="overview-card"><h4>TAM</h4><div class="value">${overview.TAM}</div></div>
                <div class="overview-card"><h4>SAM</h4><div class="value">${overview.SAM}</div></div>
                <div class="overview-card"><h4>SOM</h4><div class="value">${overview.SOM}</div><div class="stage">${overview.stage}</div></div>
                <p class="methodology-note">${overview.methodology_note}</p>
            </div>
            <div class="market-grid">
                <div class="card timeline-card"><div class="data-section"><h3>Market Growth</h3><div class="timeline">
                    ${historical.map(h => `<div class="timeline-item"><span class="year">${h.year}</span><span class="size">${h.market_size}</span></div>`).join('')}
                    <div class="timeline-item"><span class="year">${future.year} (Projected)</span><span class="size">${future.market_size}</span></div>
                </div></div></div>
                <div class="card"><div class="data-section"><h3>Key Trends</h3><ul>${data.key_trends.map(item => `<li>${item}</li>`).join('')}</ul></div></div>
                <div class="card"><div class="data-section"><h3>Top Regions for Growth</h3><ul>${data.top_regions.map(item => `<li><strong>${item.region}:</strong> ${item.why}</li>`).join('')}</ul></div></div>
            </div>`;
    }

    function renderPricingPage(data) {
        const container = document.getElementById('pricing-models-content');
        if (!container || !data) return;
        let competitorPricingHTML = data.competitor_pricing.map(comp => `
            <div class="card">
                <div class="pricing-header"><h2>${comp.name}</h2><span class="model">${comp.model}</span></div>
                <div class="tier-grid">
                    ${comp.tiers.map(tier => `
                        <div class="tier-card">
                            <h4>${tier.plan}</h4>
                            <div class="price">${tier.price_usd.includes("per") ? tier.price_usd.split(" ")[0] : tier.price_usd}</div>
                            <div class="price-note">${tier.price_usd.includes("per") ? "per " + tier.price_usd.split(" ").slice(1).join(" ") : (tier.price_usd === "Varies" ? "Based on usage" : "One-time or varied fee")}</div>
                            <ul>${tier.features.map(f => `<li>${f}</li>`).join('')}</ul>
                            <div class="target"><strong>Best for:</strong> ${tier.target_customer}</div>
                        </div>`).join('')}
                </div>
            </div>`).join('');
        container.innerHTML = `
            <div class="recommendation-grid">
                <div class="card recommendation-card"><h3>Strategic Insight</h3><p>${data.insight}</p></div>
                <div class="card recommendation-card"><h3>Recommendation</h3><p>${data.recommendation}</p></div>
            </div>
            <div class="pricing-grid">${competitorPricingHTML}</div>`;
    }

    function renderAudiencePage(data) {
        const container = document.getElementById('targeted-audience-content');
        if (!container || !data) return;
        container.innerHTML = `
            <div class="audience-personas">
                <div class="persona-card"><h3>Primary Audience</h3><p>${data.primary_audience}</p></div>
                <div class="persona-card"><h3>Secondary Audience</h3><p>${data.secondary_audience}</p></div>
            </div>
            <div class="audience-grid">
                <div class="card"><div class="data-section"><h3>Effective Channels</h3><ul>${data.channels.map(item => `<li>${item}</li>`).join('')}</ul></div></div>
                <div class="card"><div class="data-section"><h3>Marketing Strategies</h3><ul>${data.marketing_strategies.map(item => `<li>${item}</li>`).join('')}</ul></div></div>
            </div>`;
    }

    function renderSuccessPage(data) {
        const container = document.getElementById('success-suggestions-content');
        if (!container || !data) return;
        container.innerHTML = `
            <div class="success-assessment-grid card">
                <div>
                    <div class="data-section">
                        <h3>Success Assessment</h3>
                        <p class="techniques-text">${data.success_assessment.justification}</p>
                    </div>
                </div>
                <div class="probability-score">
                    <h4>Probability of Success</h4>
                    <div class="probability-circle" data-score="${data.success_assessment.success_probability}" style="--p:${data.success_assessment.success_probability}%"></div>
                </div>
            </div>
            <div class="content-grid-two-col">
                <div class="card">
                    <div class="data-section">
                        <h3>Key Risks</h3>
                        <ul class="risk-list">${data.risks.map(item => `<li>${item}</li>`).join('')}</ul>
                    </div>
                </div>
                 <div class="card">
                    <div class="data-section">
                        <h3>Risk Mitigations</h3>
                        <ul>${data.mitigations.map(item => `<li>${item}</li>`).join('')}</ul>
                    </div>
                </div>
            </div>
            <div class="card">
                <div class="data-section">
                    <h3>Go/No-Go Guidance</h3>
                    <p class="techniques-text">Proceed if the following criteria are met:</p>
                    <ul>${data.go_no_go_guidance.map(item => `<li>${item}</li>`).join('')}</ul>
                </div>
            </div>
            <div class="card">
                <div class="data-section">
                    <h3>Validation Plan</h3>
                    <div class="content-grid-three-col">
                        ${data.validation_plan.map(item => `
                            <div class="validation-card">
                                <h4>${item.experiment}</h4>
                                <div class="validation-item">
                                    <strong>Metric:</strong> <span>${item.metric}</span>
                                </div>
                                <div class="validation-item">
                                    <strong>Target:</strong> <span>${item.target}</span>
                                </div>
                                <div class="validation-item">
                                    <strong>Timeframe:</strong> <span>${item.timeframe_weeks} weeks</span>
                                </div>
                            </div>
                        `).join('')}
                    </div>
                </div>
            </div>
        `;
    }

    function renderTechPage(data) {
        const container = document.getElementById('tech-stack-content');
        if (!container || !data) return;
        container.innerHTML = `
            <div class="card system-arch-card"><div class="data-section"><h3>System Architecture</h3><p class="techniques-text">${data.system_architecture}</p></div></div>
            <div class="card"><div class="data-section"><h3>Components</h3>
                <div class="content-grid-three-col">
                    ${data.components.map(c => `
                        <div class="tier-card">
                            <div class="pricing-header" style="border-bottom: none; padding-bottom: 0; margin-bottom: 12px;">
                                <h4>${c.name}</h4><span class="build-buy-tag ${c.build_vs_buy.toLowerCase()}">${c.build_vs_buy}</span>
                            </div>
                            <p class="target" style="font-style: normal; margin-bottom: 12px;">${c.purpose}</p>
                            <strong>Key Stack:</strong><ul>${c.key_tech_stack.map(t => `<li>${t}</li>`).join('')}</ul>
                            <strong>Risks:</strong><ul class="risk-list">${c.risks.map(r => `<li>${r}</li>`).join('')}</ul>
                        </div>
                    `).join('')}
                </div>
            </div></div>
            <div class="content-grid-two-col">
                <div class="card"><div class="data-section"><h3>Infrastructure Plan</h3>
                    <div class="key-metrics-grid">
                        <div class="metric-item"><strong>Hosting</strong><span>${data.infra_plan.hosting}</span></div>
                        <div class="metric-item"><strong>Scaling</strong><span>${data.infra_plan.scaling}</span></div>
                        <div class="metric-item"><strong>Security</strong><span>${data.infra_plan.security.join(', ')}</span></div>
                        <div class="metric-item"><strong>Observability</strong><span>${data.infra_plan.observability.join(', ')}</span></div>
                    </div>
                </div></div>
                <div class="card"><div class="data-section"><h3>Data Model Notes</h3>
                    <div class="key-metrics-grid">
                        <div class="metric-item"><strong>Sources</strong><span>${data.data_model_notes.sources.join(', ')}</span></div>
                        <div class="metric-item"><strong>Schema Highlights</strong><span>${data.data_model_notes.schema_highlights.join(', ')}</span></div>
                        <div class="metric-item"><strong>Retention Policy</strong><span>${data.data_model_notes.retention_policy}</span></div>
                    </div>
                </div></div>
            </div>
            <div class="card data-table-wrapper"><div class="data-section"><h3>Integration Matrix</h3>
                <div class="table-wrapper"><table class="data-table">
                    <thead><tr><th>Service</th><th>Auth</th><th>Rate Limit</th><th>Notes</th></tr></thead>
                    <tbody>${data.integration_matrix.map(i => `<tr><td>${i.service}</td><td>${i.auth}</td><td>${i.rate_limit}</td><td>${i.notes}</td></tr>`).join('')}</tbody>
                </table></div>
            </div></div>
             <div class="card"><div class="data-section"><h3>Monthly Cost Estimates</h3>
                <div class="market-overview-grid">
                    <div class="overview-card"><h4>Development</h4><div class="value">$${Number(data.cost_estimates.dev_env_usd_month).toLocaleString()}</div></div>
                    <div class="overview-card"><h4>Staging</h4><div class="value">$${Number(data.cost_estimates.staging_env_usd_month).toLocaleString()}</div></div>
                    <div class="overview-card"><h4>Production</h4><div class="value">$${Number(data.cost_estimates.prod_env_usd_month).toLocaleString()}</div></div>
                </div>
            </div></div>
        `;
    }

    function renderTimeBudgetPage(data) {
        const container = document.getElementById('time-budget-content');
        if (!container || !data) return;
        container.innerHTML = `
            <div class="card total-budget-card">
                <h3 class="total-budget-title">Total Budget Estimate</h3>
                <div class="price-range">$${data.budget_estimate.total_usd.low.toLocaleString()} - $${data.budget_estimate.total_usd.high.toLocaleString()}</div>
                <div class="table-wrapper"><table class="data-table">
                    <thead><tr><th>Phase</th><th>Low Estimate</th><th>High Estimate</th></tr></thead>
                    <tbody>${data.budget_estimate.by_phase_usd.map(p => `<tr><td>${p.phase}</td><td>$${p.low.toLocaleString()}</td><td>$${p.high.toLocaleString()}</td></tr>`).join('')}</tbody>
                </table></div>
            </div>
            <div class="card"><div class="data-section"><h3>Project Phases</h3>
                <div class="content-grid-two-col">
                    ${data.phases.map(p => `
                        <div class="phase-card">
                            <h4>${p.name} <span class="phase-duration">(~${p.duration_weeks} weeks)</span></h4>
                            <strong>Deliverables:</strong><ul>${p.major_deliverables.map(d => `<li>${d}</li>`).join('')}</ul>
                            <strong>Team Mix:</strong><ul>${p.team_mix.map(t => `<li>${t.role} (${t.FTE} FTE)</li>`).join('')}</ul>
                        </div>
                    `).join('')}
                </div>
            </div></div>
             <div class="content-grid-two-col">
                <div class="card"><div class="data-section"><h3>Schedule Risks</h3><ul class="risk-list">${data.schedule_risks.map(r => `<li>${r}</li>`).join('')}</ul></div></div>
                <div class="card"><div class="data-section"><h3>Acceleration Options</h3><ul>${data.acceleration_options.map(o => `<li><strong>${o.option}:</strong> ${o.trade_off}</li>`).join('')}</ul></div></div>
            </div>
            <div class="card data-table-wrapper">
                <div class="data-section"><h3>Resource Plan</h3>
                <div class="table-wrapper"><table class="data-table">
                    <thead><tr><th>Role</th><th>FTE</th><th>Seniority</th></tr></thead>
                    <tbody>${data.resource_plan.map(r => `<tr><td>${r.role}</td><td>${r.FTE}</td><td>${r.seniority}</td></tr>`).join('')}</tbody>
                </table></div>
            </div></div>
        `;
    }

    function renderTeamPage(data) {
        const container = document.getElementById('team-plan-content');
        if (!container || !data) return;
        container.innerHTML = `
            <div class="content-grid-two-col">
                <div class="card">
                    <div class="data-section">
                        <h3>Organizational Design</h3>
                        <div class="metric-item"><strong>Structure</strong><span>${data.org_design.structure}</span></div>
                        <div class="metric-item"><strong>Reporting Lines</strong><ul>${data.org_design.reporting_lines.map(line => {
            const manager = Object.keys(line)[0];
            const reports = line[manager].join(', ');
            return `<li><strong>${manager}</strong> → ${reports}</li>`;
        }).join('')}</ul></div>
                    </div>
                </div>
                <div class="card">
                    <div class="data-section">
                        <h3>Sourcing Strategy</h3>
                        <strong>To Keep In-House:</strong><ul>${data.vendor_vs_inhouse.what_to_keep_inhouse.map(item => `<li>${item}</li>`).join('')}</ul>
                        <strong>To Outsource:</strong><ul class="risk-list">${data.vendor_vs_inhouse.what_to_outsource.map(item => `<li>${item}</li>`).join('')}</ul>
                    </div>
                </div>
            </div>
            <div class="card">
                <div class="data-section"><h3>Core Team Profile</h3>
                    <div class="content-grid-three-col">${data.core_team_profile.map(profile => `
                        <div class="role-card">
                            <h4>${profile.role}</h4>
                            <ul>${profile.skills.map(skill => `<li>${skill}</li>`).join('')}</ul>
                        </div>
                    `).join('')}</div>
                </div>
            </div>
            <div class="card data-table-wrapper">
                <div class="data-section"><h3>Hiring Plan</h3>
                    <div class="table-wrapper"><table class="data-table">
                        <thead><tr><th>Role</th><th>Quarter</th><th>Seniority</th><th>Reason</th></tr></thead>
                        <tbody>${data.hiring_plan.map(p => `<tr><td>${p.role}</td><td>${p.quarter}</td><td>${p.seniority}</td><td style="white-space: normal;">${p.reason}</td></tr>`).join('')}</tbody>
                    </table></div>
                </div>
            </div>
             <div class="card">
                <div class="data-section"><h3>Interview Rubrics</h3>
                    <div class="content-grid-three-col">${data.interview_rubrics.map(rubric => `
                        <div class="role-card">
                            <h4>${rubric.role}</h4>
                            <strong>Top Signals to Look For:</strong>
                            <ul>${rubric.top_signals.map(signal => `<li>${signal}</li>`).join('')}</ul>
                        </div>
                    `).join('')}</div>
                </div>
            </div>
        `;
    }


    // --- INITIALIZE DASHBOARD ---
    function initializeDashboard(data) {
        if (!data || !data.result) { console.error("Data structure is incorrect or 'result' object is missing."); return; }
        const resultData = data.result;

        if (resultData.competitors) { renderCompetitorsPage(resultData.competitors); }
        if (resultData.market) { renderMarketTrendsPage(resultData.market); }
        if (resultData.pricing) { renderPricingPage(resultData.pricing); }
        if (resultData.audience) { renderAudiencePage(resultData.audience); }
        if (resultData.success) { renderSuccessPage(resultData.success); }
        if (resultData.tech) { renderTechPage(resultData.tech); }
        if (resultData['time-budget']) { renderTimeBudgetPage(resultData['time-budget']); }
        if (resultData.team) {
            renderTeamPage(resultData.team);
        }
        if (resultData.roadmap) { renderRoadmapPage(resultData.roadmap); }

    }


    // --- SIDEBAR TOGGLE LOGIC ---
    const sidebar = document.getElementById('sidebar');
    const toggleBtn = document.getElementById('sidebar-toggle');
    const closeBtn = document.getElementById('sidebar-close');
    const overlay = document.getElementById('overlay');
    const openSidebar = () => { sidebar.classList.add('is-open'); overlay.classList.add('is-active'); };
    const closeSidebar = () => { sidebar.classList.remove('is-open'); overlay.classList.remove('is-active'); };
    toggleBtn.addEventListener('click', openSidebar);
    closeBtn.addEventListener('click', closeSidebar);
    overlay.addEventListener('click', closeSidebar);

    // --- TABBING LOGIC ---
    const navLinks = document.querySelectorAll('.sidebar-nav a');
    const pageContents = document.querySelectorAll('.page-content');
    const headerTextContainer = document.getElementById('main-header-text');

    const pageHeaders = {
        competitors: { title: "Competitor Analysis", subtitle: "An in-depth look at the key players in the handmade e-commerce space." },
        'market-trends': { title: "Market Trends", subtitle: "An overview of the handmade e-commerce market landscape." },
        'pricing-models': { title: "Industry Pricing", subtitle: "A comparative analysis of pricing strategies in the market." },
        'targeted-audience': { title: "Target Audience", subtitle: "Understanding customer personas and outreach channels." },
        'success-suggestions': { title: "Success Suggestions", subtitle: "Key risks, mitigations, and validation plan for your idea." },
        'tech-stack': { title: "Tech Stack", subtitle: "The technology and infrastructure blueprint for the project." },
        'time-budget': { title: "Time & Budget", subtitle: "Project timeline, budget, and resource planning." },
        'team-plan': { title: "Team Plan", subtitle: "Organizational structure, roles, and hiring strategy." },
        'roadmap': { title: "Roadmap", subtitle: "A detailed project roadmap with critical path and launch checklist." }
    };

    navLinks.forEach(link => {
        link.addEventListener('click', (e) => {
            e.preventDefault();
            const targetTab = link.getAttribute('data-tab');
            if (!targetTab) return;

            const currentActive = document.querySelector('.page-content.is-active');
            const newActive = document.getElementById(`${targetTab}-content`);
            if (currentActive === newActive) {
                closeSidebar();
                return;
            };

            navLinks.forEach(l => l.classList.remove('active'));
            link.classList.add('active');

            const headerContent = pageHeaders[targetTab];
            if (headerContent) {
                headerTextContainer.innerHTML = `<h1>${headerContent.title}</h1><p>${headerContent.subtitle}</p>`;
            }

            if (currentActive) { currentActive.classList.remove('is-active'); }
            if (newActive) { newActive.classList.add('is-active'); }

            closeSidebar();
        });
    });
});

// Replace the old setupPDFDownloader function with this new one.
function setupPDFDownloader() {
    const downloadBtn = document.getElementById('download-pdf-btn');
    // This is the wrapper that contains all 9 of your report sections.
    const reportElement = document.getElementById('page-content-wrapper');

    if (!downloadBtn || !reportElement) {
        console.error("Download button or report container not found!");
        return;
    }

    downloadBtn.addEventListener('click', () => {
        downloadBtn.disabled = true;
        downloadBtn.textContent = 'Generating...';

        // --- KEY CHANGE: Temporarily show all hidden sections ---
        const allSections = reportElement.querySelectorAll('.page-content');
        allSections.forEach(section => {
            section.style.display = 'block';
            section.style.opacity = '1';          // ✅ force visible
            section.style.visibility = 'visible'; // ✅ force visible
        });

        // ✅ force a solid background for PDF
        reportElement.style.background = '#ffffff';


        const options = {
            margin: [0.5, 0.5, 0.5, 0.5], // Margins in inches
            filename: 'Complete_Business_Report.pdf',
            image: { type: 'jpeg', quality: 0.98 },
            html2canvas: { scale: 2, useCORS: true, logging: false },
            jsPDF: { unit: 'in', format: 'a4', orientation: 'portrait' }
        };

        html2pdf().from(reportElement).set(options).save().then(() => {
            // --- KEY CHANGE: Restore original view after PDF is saved ---
            allSections.forEach(section => {
                section.style.display = '';
                section.style.opacity = '';
                section.style.visibility = '';
            });

            // restore background
            reportElement.style.background = '';


            downloadBtn.disabled = false;
            downloadBtn.textContent = 'Download Report';
        }).catch(err => {
            console.error("Error generating PDF:", err);
            // Also restore the view on error
            allSections.forEach(section => {
                section.style.display = '';
                section.style.opacity = '';
                section.style.visibility = '';
            });

            // restore background
            reportElement.style.background = '';

            downloadBtn.disabled = false;
            downloadBtn.textContent = 'Download Report';
        });
    });
}

document.addEventListener("DOMContentLoaded", () => {
    setTimeout(() => {
        document.getElementById('download-pdf-btn').style.display = 'block';
    }, 1500);
});